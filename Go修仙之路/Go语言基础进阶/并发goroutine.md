# 并发goroutine

## 并发与并行

- 多线程程序在**单核**上运行，就是**并发**
- 多线程程序在**多核**上运行，就是**并行**

## 进程、线程与协程

- 进程是应用程序启动的实例
- 线程是进程的实际执行者，从属于进程。一个进程至少包含一个主线程，也可以有多个子线程。
- 协程是比线程更加轻量级的存在；一个线程可以拥有多个协程；且不被操作系统内核所管理，而是完全由程序所控制

## 线程的痛点以及协程是如何解决的？

生产者消费者模式下

### 线程之间的协作性能不高的原因

1. 涉及到**同步锁**
2. 涉及到线程**阻塞状态**和**可运行状态**的切换
3. 涉及线程的**上下文切换**

### 协程是如何解决的？

1. 协程完全**由程序控制**，不需要额外消耗系统资源

2. 协程拥有自己的**寄存器上下文**和**栈**

   协程调度切换时，会将**寄存器上下文和栈保存到其他地方**，在切换回来的时候，恢复先前保存的寄存器上下文和栈。直接**操作栈**则没有内核切换的开销，可以**不加锁的访问全局变量**，所以上下文的切换非常快。

## Go协程的特点

- 有独立的栈空间
- 共享程序堆空间
- 调度由用户控制
- 协程是轻量级的线程

## 开启协程

`go + [调用方法]`

## 多协程资源竞争问题

- 使用并发安全的数据结构
- 使用全局锁
- 利用队列